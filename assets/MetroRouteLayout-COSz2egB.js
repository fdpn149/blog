import{j as e,D as O,u as w,a as B,r as k,L as P}from"./index-Bjup3e7g.js";import{c as U,s as E,M as z}from"./MainLayout-CYB4WwLE.js";import{m as n}from"./Metro.module-CUZdgrOY.js";/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],W=U("arrow-right",F),D={NORMAL:"NORMAL",INTERCHANGE:"INTERCHANGE",TERMINUS:"TERMINUS"},_=({station:o,currentColor:l,currentRouteId:N,isActive:r,isLast:x,onClick:u})=>{const{type:h,title:j,connectedRoutes:i}=o,m=h===D.INTERCHANGE,g=m?n.nodeLarge:n.nodeNormal,y=m?n.labelLarge:n.labelSmall,I=m?(()=>{if(!i||i.length<2)return"";const R=i.length,S=i.findIndex(d=>d.routeId===N);if(S===-1)return"";let v=[];const C=180/(R-1);for(let d=1;d<R;d++){const M=(S+d)%R,T=i[M],$=(d-1)*C,A=d*C;v.push(`${T.color} ${$}deg ${A}deg`)}return v.push(`${l} 180deg 360deg`),`conic-gradient(${v.join(", ")})`})():"";let L={};return m&&I?L={background:I,padding:"6px"}:L={borderColor:l,borderWidth:"5px",borderStyle:"solid",backgroundColor:"white"},e.jsxs("div",{className:n.stationNode,children:[e.jsx("div",{className:n.nodeTrackCol,children:e.jsx("button",{onClick:()=>u(o),className:`${n.nodeButton} ${g} ${r&&!m?n.activeScale:""}`,style:L,"aria-label":`Select station: ${j}`,children:e.jsx("div",{className:n.nodeInner,children:r&&e.jsx("div",{className:n.activeDot,style:{backgroundColor:l}})})})}),e.jsx("div",{className:n.nodeLabelCol,children:e.jsx("div",{className:n.nodeLabelWrapper,children:e.jsx("h3",{className:`${n.nodeLabel} ${y} ${r?n.active:n.inactive}`,children:j})})})]})},q=({stations:o,currentRouteName:l,currentRouteColor:N,currentRouteId:r,activeStationId:x,onStationClick:u})=>e.jsx("div",{className:n.mapContainer,children:e.jsxs("div",{className:n.stationsList,children:[e.jsx("div",{className:n.routeLineBg,style:{backgroundColor:N}}),o.map((h,j)=>{const i=h.id===x,m=j===o.length-1;return e.jsx(_,{station:h,currentColor:N,currentRouteId:r,isActive:i,isLast:m,onClick:u},h.id)})]})}),J=({station:o,isLastStation:l,onNext:N,onNavigate:r})=>{const{title:x,description:u,link:h}=o;return e.jsxs("div",{className:n.contentPanel,children:[e.jsxs("div",{className:n.panelBody,children:[e.jsx("h2",{className:n.panelTitle,children:x}),e.jsx("p",{className:n.panelDesc,children:u}),h?e.jsx("div",{className:n.panelProse,children:e.jsx(O,{props:{path:h}})}):e.jsx("div",{className:n.panelProse,children:e.jsxs("p",{children:["點擊右下角的按鈕進入課程，或選擇左側的其他站點進行跳轉。",o.type===D.INTERCHANGE&&e.jsx("span",{children:" 此站點為轉乘站，點擊左側轉乘站可切換至其他路線。"})]})})]}),e.jsx("div",{className:n.panelFooter,children:!l&&e.jsxs("button",{onClick:N,className:n.nextBtn,children:["下一站",e.jsx(W,{size:18,className:n.iconMl})]})})]})},X=({routes:o,defaultRouteId:l,basePath:N,onResolveConflict:r=null})=>{const x=w(),u=B(),h=t=>{t.preventDefault(),x("/"),window.history.replaceState(null,"","/blog/")},j=()=>{const t=decodeURIComponent(u.pathname);if(r){const a=[];for(const[s,c]of Object.entries(o)){const f=c.stations.find(p=>p.link===t);f&&a.push({routeId:s,station:f})}if(a.length>0){const s=r(t,a);if(s&&s.routeId)return s.routeId}}for(const[a,s]of Object.entries(o))if(s.stations.some(c=>c.link===t))return a;return l},[i,m]=k.useState(j),[g,y]=k.useState(o[i].stations),[b,I]=k.useState(()=>{const t=decodeURIComponent(u.pathname),a=o[i].stations.find(s=>s.link===t);return a?a.id:o[i].stations[0].id}),[L,R]=k.useState(!1),S=g.findIndex(t=>t.id===b),v=g[S]||g[0],C=S===g.length-1,d=o[i];k.useEffect(()=>{const t=decodeURIComponent(u.pathname);let a=null,s=null;const c=[];for(const[f,p]of Object.entries(o)){const G=p.stations.find(H=>H.link===t);G&&c.push({routeId:f,station:G})}if(c.length>0){const f=c.find(p=>p.routeId===i);if(f)a=f.station,s=f.routeId;else if(r){const p=r(t,c);p?(a=p.station,s=p.routeId):(a=c[0].station,s=c[0].routeId)}else a=c[0].station,s=c[0].routeId}else s=l,a=o[l].stations[0];a&&s&&(i!==s&&(m(s),y(o[s].stations)),b!==a.id&&I(a.id))},[u.pathname,i,o,r]);const M=t=>{if(t.type===D.INTERCHANGE&&t.connectedRoutes&&t.connectedRoutes.length>1&&b===t.id){const a=t.connectedRoutes.findIndex(s=>s.routeId===i);if(a!==-1){const s=(a+1)%t.connectedRoutes.length,c=t.connectedRoutes[s];m(c.routeId),y(o[c.routeId].stations),I(c.stationId);return}}I(t.id),t.link?x(t.link):x(N),R(!1)},T=()=>{if(C)return;const t=g[S+1];t&&M(t)},$=t=>{t&&x(t)},A=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:E.sidebarHeader,children:e.jsxs(P,{to:"/",className:E.brandLink,onClick:h,children:[e.jsx("h1",{className:E.brandTitle,children:"波峰小棧"}),e.jsx("p",{className:E.brandSubtitle,children:"Metro Learning Station"})]})}),e.jsx("div",{style:{padding:"1.5rem 1.5rem 0 1.5rem"},children:e.jsx("h1",{className:n.routeTitle,style:{color:d.color},children:d.name})}),e.jsx(q,{stations:g,currentRouteName:d.name,currentRouteColor:d.color,currentRouteId:i,activeStationId:b,onStationClick:M})]});return e.jsx(z,{sidebar:A,children:e.jsx(J,{station:v,isLastStation:C,onNext:T,onNavigate:$})})};export{X as M,D as S};
