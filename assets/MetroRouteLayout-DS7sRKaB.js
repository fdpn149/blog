import{c as O,j as e,D as H,u as B,a as P,r as v,s as L,M as U}from"./index-Chn6-Wh6.js";import{m as n}from"./Metro.module-CUZdgrOY.js";/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],z=O("arrow-right",w),A={NORMAL:"NORMAL",INTERCHANGE:"INTERCHANGE",TERMINUS:"TERMINUS"},F=({station:a,currentColor:l,currentRouteId:N,isActive:d,isLast:g,onClick:u})=>{const{type:h,title:c,connectedRoutes:m}=a,r=h===A.INTERCHANGE,C=r?n.nodeLarge:n.nodeNormal,S=r?n.labelLarge:n.labelSmall,M=r?(()=>{if(!m||m.length<2)return"";const j=m.length,k=m.findIndex(x=>x.routeId===N);if(k===-1)return"";let b=[];const I=180/(j-1);for(let x=1;x<j;x++){const E=(k+x)%j,T=m[E],$=(x-1)*I,t=x*I;b.push(`${T.color} ${$}deg ${t}deg`)}return b.push(`${l} 180deg 360deg`),`conic-gradient(${b.join(", ")})`})():"";let R={};return r&&M?R={background:M,padding:"6px"}:R={borderColor:l,borderWidth:"5px",borderStyle:"solid",backgroundColor:"white"},e.jsxs("div",{className:n.stationNode,children:[e.jsx("div",{className:n.nodeTrackCol,children:e.jsx("button",{onClick:()=>u(a),className:`${n.nodeButton} ${C} ${d&&!r?n.activeScale:""}`,style:R,"aria-label":`Select station: ${c}`,children:e.jsx("div",{className:n.nodeInner,children:d&&e.jsx("div",{className:n.activeDot,style:{backgroundColor:l}})})})}),e.jsx("div",{className:n.nodeLabelCol,children:e.jsx("div",{className:n.nodeLabelWrapper,children:e.jsx("h3",{className:`${n.nodeLabel} ${S} ${d?n.active:n.inactive}`,children:c})})})]})},W=({stations:a,currentRouteName:l,currentRouteColor:N,currentRouteId:d,activeStationId:g,onStationClick:u})=>e.jsx("div",{className:n.mapContainer,children:e.jsxs("div",{className:n.stationsList,children:[e.jsx("div",{className:n.routeLineBg,style:{backgroundColor:N}}),a.map((h,c)=>{const m=h.id===g,r=c===a.length-1;return e.jsx(F,{station:h,currentColor:N,currentRouteId:d,isActive:m,isLast:r,onClick:u},h.id)})]})}),_=({station:a,isLastStation:l,onNext:N,onNavigate:d})=>{const{title:g,description:u,link:h}=a;return e.jsxs("div",{className:n.contentPanel,children:[e.jsxs("div",{className:n.panelBody,children:[e.jsx("h2",{className:n.panelTitle,children:g}),e.jsx("p",{className:n.panelDesc,children:u}),h?e.jsx("div",{className:n.panelProse,children:e.jsx(H,{props:{path:h}})}):e.jsx("div",{className:n.panelProse,children:e.jsxs("p",{children:["點擊右下角的按鈕進入課程，或選擇左側的其他站點進行跳轉。",a.type===A.INTERCHANGE&&e.jsx("span",{children:" 此站點為轉乘站，點擊左側轉乘站可切換至其他路線。"})]})})]}),e.jsx("div",{className:n.panelFooter,children:!l&&e.jsxs("button",{onClick:N,className:n.nextBtn,children:["下一站",e.jsx(z,{size:18,className:n.iconMl})]})})]})},K=({routes:a,defaultRouteId:l,basePath:N,onResolveConflict:d=null})=>{const g=B(),u=P(),h=()=>{const t=decodeURIComponent(u.pathname);if(d){const o=[];for(const[s,i]of Object.entries(a)){const f=i.stations.find(p=>p.link===t);f&&o.push({routeId:s,station:f})}if(o.length>0){const s=d(t,o);if(s&&s.routeId)return s.routeId}}for(const[o,s]of Object.entries(a))if(s.stations.some(i=>i.link===t))return o;return l},[c,m]=v.useState(h),[r,C]=v.useState(a[c].stations),[S,y]=v.useState(()=>{const t=decodeURIComponent(u.pathname),o=a[c].stations.find(s=>s.link===t);return o?o.id:a[c].stations[0].id}),[M,R]=v.useState(!1),j=r.findIndex(t=>t.id===S),k=r[j]||r[0],b=j===r.length-1,I=a[c];v.useEffect(()=>{const t=decodeURIComponent(u.pathname);let o=null,s=null;const i=[];for(const[f,p]of Object.entries(a)){const D=p.stations.find(G=>G.link===t);D&&i.push({routeId:f,station:D})}if(i.length>0){const f=i.find(p=>p.routeId===c);if(f)o=f.station,s=f.routeId;else if(d){const p=d(t,i);p?(o=p.station,s=p.routeId):(o=i[0].station,s=i[0].routeId)}else o=i[0].station,s=i[0].routeId}else s=l,o=a[l].stations[0];o&&s&&(c!==s&&(m(s),C(a[s].stations)),S!==o.id&&y(o.id))},[u.pathname,c,a,d]);const x=t=>{if(t.type===A.INTERCHANGE&&t.connectedRoutes&&t.connectedRoutes.length>1&&S===t.id){const o=t.connectedRoutes.findIndex(s=>s.routeId===c);if(o!==-1){const s=(o+1)%t.connectedRoutes.length,i=t.connectedRoutes[s];m(i.routeId),C(a[i.routeId].stations),y(i.stationId);return}}y(t.id),t.link?g(t.link):g(N),R(!1)},E=()=>{if(b)return;const t=r[j+1];t&&x(t)},T=t=>{t&&g(t)},$=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:L.sidebarHeader,children:e.jsxs("a",{href:"/",className:L.brandLink,children:[e.jsx("h1",{className:L.brandTitle,children:"波峰小棧"}),e.jsx("p",{className:L.brandSubtitle,children:"Metro Learning Station"})]})}),e.jsx("div",{style:{padding:"1.5rem 1.5rem 0 1.5rem"},children:e.jsx("h1",{className:n.routeTitle,style:{color:I.color},children:I.name})}),e.jsx(W,{stations:r,currentRouteName:I.name,currentRouteColor:I.color,currentRouteId:c,activeStationId:S,onStationClick:x})]});return e.jsx(U,{sidebar:$,children:e.jsx(_,{station:k,isLastStation:b,onNext:E,onNavigate:T})})};export{K as M,A as S};
