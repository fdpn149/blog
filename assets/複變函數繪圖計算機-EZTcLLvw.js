import{r as M,j as l}from"./index-Bjup3e7g.js";import{z as mt,s as ct,t as dt,i as ut}from"./zoom-CZ9WWyAN.js";import{s as r}from"./MathTools.module-C_ZWGUcX.js";import{u as pt,a as gt,p as it,c as Mt,f as yt,e as bt}from"./pureFunctionsAny.generated-CxeGzZfn.js";const Yt=()=>{const[N,$]=M.useState(0),[h,I]=M.useState(!1),[C,v]=M.useState(10),w=M.useRef(null),k=M.useRef(null),[d,y]=M.useState({width:600,height:400});M.useEffect(()=>{if(!k.current)return;const c=new ResizeObserver(e=>{if(e[0]){const{width:i,height:a}=e[0].contentRect;y({width:i,height:Math.max(400,a)})}});return c.observe(k.current),()=>c.disconnect()},[]);const u=M.useMemo(()=>{const c=pt(N,"deg").toNumber("rad"),e=t=>{const n=Mt({r:t,phi:c}),f=yt(n);let b=Number(bt(f));return(!Number.isFinite(b)||b>1e6)&&(b=null),{x:t,z:n,y:f,mag:b}},i=1e3,a=-10,z=10,O=(z-a)/i;let R=[];for(let t=0;t<=i;t++)R.push(e(a+t*O));const x=R.map(t=>t.mag).filter(t=>t!==null&&t<1e6);x.sort((t,n)=>t-n);let X=10,T=1,D=10;x.length>0&&(X=x[Math.floor(x.length*.95)],T=x[Math.floor(x.length*.5)],D=x[x.length-1],x[0]);let E=D>1e3?Math.max(X*2,T*5):D;E<=0&&(E=1);let j=h?E:C,A=0,F=[R[0]];const W=14,L=(j-A)/300,G=j*10,Y=(z-a)/5e4,p=(t,n,f)=>{let b=!1;const Q=t.mag!==null?t.mag:1e6,B=n.mag!==null?n.mag:1e6;if(f<W&&Math.abs(n.x-t.x)>Y&&Math.min(Q,B)<G){const m=t.y.re??(typeof t.y=="number"?t.y:0),_=t.y.im??0,H=n.y.re??(typeof n.y=="number"?n.y:0),g=n.y.im??0;Math.hypot(m-H,_-g)>L&&(b=!0)}if(b){const m=(t.x+n.x)/2,_=e(m);p(t,_,f+1),p(_,n,f+1)}else F.push(n)};for(let t=1;t<=i;t++)p(R[t-1],R[t],0);const V=j+(j-A)*.5,U=[];return F.forEach(t=>{if(t.mag!==null&&t.mag<V){let n=0;try{const f=gt(t.y);n=f<0?2*it+f:f}catch{}U.push({x:t.x,y:Number(t.mag.toFixed(10)),color:St(n/(2*it),1,1)})}}),{points:U,viewMax:j,viewMin:A,xMin:a,xMax:z}},[N,h,C]),q=M.useRef(null);M.useEffect(()=>{const c=w.current;if(!c)return;const e=c.getContext("2d"),{width:i,height:a}=d,{points:z,viewMax:O,viewMin:R,xMin:x,xMax:X}=u,T=window.devicePixelRatio||1;c.width=i*T,c.height=a*T,e.scale(T,T);const D=R,E=O,j=(X-x)*.05,A=(E-D)*.05,F=x-j,W=X+j,L=Math.max(0,D-A),G=E+A,Y=t=>(t-F)/(W-F)*i,p=t=>a-(t-L)/(G-L)*a,V=()=>{const t=dt(c);e.clearRect(0,0,i,a);const n=getComputedStyle(document.body),f=n.getPropertyValue("--text-color").trim()||"#fff",b=n.getPropertyValue("--border-color").trim()||"rgba(255, 255, 255, 0.4)";e.lineWidth=1,e.strokeStyle=b;const B=80/(i/(W-F)*t.k);let m=Math.pow(10,Math.floor(Math.log10(B)));B/m>=5?m*=5:B/m>=2&&(m*=2);const H=80/(a/(G-L)*t.k);let g=Math.pow(10,Math.floor(Math.log10(H)));H/g>=5?g*=5:H/g>=2&&(g*=2),e.beginPath();const Z=0,J=O*1.5,tt=Math.min(a,Math.max(0,t.applyY(p(J)))),et=Math.min(a,Math.max(0,t.applyY(p(Z)))),st=Math.floor(x/m)*m;for(let s=st;s<=X;s+=m){const o=t.applyX(Y(s));o>=0&&o<=i&&(e.moveTo(o,tt),e.lineTo(o,et))}const rt=x,ht=X,at=Math.min(i,Math.max(0,t.applyX(Y(rt)))),nt=Math.min(i,Math.max(0,t.applyX(Y(ht)))),ot=Math.floor(Z/g)*g;for(let s=ot;s<=J;s+=g){const o=t.applyY(p(s));o>=0&&o<=a&&(e.moveTo(at,o),e.lineTo(nt,o))}e.stroke();const S=t.applyY(p(0));S>=0&&S<=a&&(e.lineWidth=2,e.beginPath(),e.moveTo(at,S),e.lineTo(nt,S),e.stroke());const P=t.applyX(Y(0));P>=0&&P<=i&&(e.lineWidth=2,e.beginPath(),e.moveTo(P,tt),e.lineTo(P,et),e.stroke());const xt=S>=0&&S<=a-15?S+4:a-15,ft=P>=20&&P<=i?P-4:20;e.fillStyle=f,e.font="10px sans-serif",e.textAlign="center",e.textBaseline="top";for(let s=st;s<=X;s+=m){const o=t.applyX(Y(s));o>=10&&o<=i-10&&(Math.abs(s)>1e-6||S<0||S>a)&&e.fillText(parseFloat(s.toPrecision(3)),o,xt)}e.textAlign="right",e.textBaseline="middle";for(let s=ot;s<=J;s+=g){const o=t.applyY(p(s));o>=10&&o<=a-10&&(Math.abs(s)>1e-6||P<0||P>i)&&e.fillText(parseFloat(s.toPrecision(3)),ft,o)}e.textAlign="start",e.textBaseline="alphabetic",z.forEach(s=>{const o=t.applyX(Y(s.x)),K=t.applyY(p(s.y));o>=-2&&o<=i+2&&K>=-2&&K<=a+2&&(e.fillStyle=s.color,e.beginPath(),e.arc(o,K,2,0,2*Math.PI),e.fill())})},U=mt().scaleExtent([.1,50]).on("zoom",V);q.current=U,ct(c).call(U),V()},[u,d]);const lt=()=>{const c=w.current;c&&q.current&&ct(c).transition().duration(500).call(q.current.transform,ut)};return l.jsxs("section",{className:r.mathSection,children:[l.jsx("h3",{children:"y∠c = f(x∠φ)"}),l.jsx("p",{children:"0° ≤ c(color hue) < 360°"}),l.jsxs("div",{className:r.sliderContainer,children:[l.jsxs("label",{children:[l.jsxs("span",{className:r.sliderLabelText,children:["φ (deg): ",N.toFixed(1)]}),l.jsx("input",{type:"range",min:"0",max:"359.9",step:"0.1",value:N,onChange:c=>$(parseFloat(c.target.value))})]}),l.jsxs("div",{className:r.controlPanel,children:[l.jsxs("label",{className:r.controlLabel,children:[l.jsxs("label",{className:r.toggleSwitch,children:[l.jsx("input",{type:"checkbox",checked:h,onChange:c=>I(c.target.checked)}),l.jsx("span",{className:r.slider})]}),"畫面自適應"]}),!h&&l.jsxs("label",{className:r.controlLabel,children:[l.jsx("span",{children:"數值範圍 (yMax):"}),l.jsx("input",{className:`${r.input} ${r.fixedScaleInput}`,type:"number",value:C,onChange:c=>{const e=parseFloat(c.target.value);!isNaN(e)&&e>0&&v(e)},min:"0.1",step:"any"})]}),l.jsx("button",{onClick:lt,className:`${r.buttonSecondary} ${r.alignRight}`,children:"重設視角"})]})]}),l.jsx("div",{ref:k,className:r.canvasContainer,children:l.jsx("canvas",{ref:w,className:`${r.canvas} ${r.cartesian}`})})]})};function St(N,$,h){const I=Math.floor(N*6),C=N*6-I,v=h*(1-$),w=h*(1-C*$),k=h*(1-(1-C)*$);let d=0,y=0,u=0;switch((I%6+6)%6){case 0:[d,y,u]=[h,k,v];break;case 1:[d,y,u]=[w,h,v];break;case 2:[d,y,u]=[v,h,k];break;case 3:[d,y,u]=[v,w,h];break;case 4:[d,y,u]=[k,v,h];break;case 5:[d,y,u]=[h,v,w];break}return`rgb(${Math.round(d*255)}, ${Math.round(y*255)}, ${Math.round(u*255)})`}export{Yt as default};
