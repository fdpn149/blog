import{r as b,j as r}from"./index-Bjup3e7g.js";import{z as et,s as q,t as st,i as at}from"./zoom-CZ9WWyAN.js";import{s as l}from"./MathTools.module-C_ZWGUcX.js";import{u as G,a as nt,p as W,c as ot,m as ct,t as rt,d as lt,b as it,e as dt}from"./pureFunctionsAny.generated-CxeGzZfn.js";const gt=()=>{const[N,T]=b.useState(0),[i,A]=b.useState(!1),[P,S]=b.useState(10),j=b.useRef(null),v=b.useRef(null),[x,M]=b.useState({width:600,height:600});b.useEffect(()=>{if(!v.current)return;const a=new ResizeObserver(e=>{if(e[0]){const{width:u,height:p}=e[0].contentRect;M({width:u,height:Math.max(400,p)})}});return a.observe(v.current),()=>a.disconnect()},[]);const m=b.useMemo(()=>{const a=G(N,"deg").toNumber("rad"),e=t=>{const o=G(t,"deg").toNumber("rad"),c=ot({r:o,phi:a}),d=ct(rt(c),lt(1,it(c)));let s=Number(dt(d));return(!Number.isFinite(s)||s>1e6)&&(s=null),{thetaDeg:t,z:c,y:d,rMag:s}},u=0,p=720,$=720,z=(p-u)/$;let g=[];for(let t=0;t<=$;t++)g.push(e(u+t*z));const f=g.map(t=>t.rMag).filter(t=>t!==null&&t<1e6);f.sort((t,o)=>t-o);let X=10,I=1,w=10;f.length>0&&(X=f[Math.floor(f.length*.95)],I=f[Math.floor(f.length*.5)],w=f[f.length-1],f[0]);let k=w>1e3?Math.max(X*2,I*5):w;k<=0&&(k=1);let R=i?k:P,C=[g[0]];const F=14,U=R/300,Y=R*10,B=(p-u)/5e4,n=(t,o,c)=>{let d=!1;const s=t.rMag!==null?t.rMag:1e6,H=o.rMag!==null?o.rMag:1e6;if(c<F&&Math.abs(o.thetaDeg-t.thetaDeg)>B&&Math.min(s,H)<Y){const h=t.y.re??(typeof t.y=="number"?t.y:0),y=t.y.im??0,L=o.y.re??(typeof o.y=="number"?o.y:0),_=o.y.im??0;Math.hypot(h-L,y-_)>U&&(d=!0)}if(d){const h=(t.thetaDeg+o.thetaDeg)/2,y=e(h);n(t,y,c+1),n(y,o,c+1)}else C.push(o)};for(let t=1;t<=$;t++)n(g[t-1],g[t],0);const D=R*1.5,E=[];return C.forEach(t=>{if(t.rMag!==null&&t.rMag<D){let o=0;try{const s=nt(t.y);o=s<0?2*W+s:s}catch{}const c=Number(t.rMag.toFixed(10)),d=G(t.thetaDeg,"deg").toNumber("rad");E.push({x:c*Math.cos(d),y:c*Math.sin(d),color:ht(o/(2*W),1,1)})}}),{points:E,viewMax:R}},[N,i,P]),O=b.useRef(null);b.useEffect(()=>{const a=j.current;if(!a)return;const e=a.getContext("2d"),{width:u,height:p}=x,{points:$,viewMax:z}=m,g=window.devicePixelRatio||1;a.width=u*g,a.height=p*g,e.scale(g,g);const X=z*1.2,I=Math.min(u,p),w=u/2,k=p/2,R=I/2/X,C=n=>w+n*R,F=n=>k-n*R,U=(n,D,E)=>{e.lineWidth=1,e.strokeStyle=E,e.fillStyle=D,e.font="10px sans-serif";const t={x:n.applyX(w),y:n.applyY(k)},c=80/(R*n.k),d=Math.floor(Math.log10(c));let s=Math.pow(10,d);c/s>=5?s*=5:c/s>=2&&(s*=2);const H=z*1.5;for(let h=s;h<=H;h+=s){const y=h*R*n.k;e.beginPath(),e.arc(t.x,t.y,y,0,2*Math.PI),e.stroke(),e.fillText(parseFloat(h.toPrecision(3)),t.x+y+2,t.y-2)}for(let h=0;h<360;h+=45){const y=h*(Math.PI/180),L=H,_=L*Math.cos(y),V=L*Math.sin(y),J=n.applyX(C(_)),K=n.applyY(F(V));e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(J,K),e.stroke();const Q=n.applyX(C(_*1.05)),tt=n.applyY(F(V*1.05));e.textAlign="center",e.textBaseline="middle",e.fillText(`${h}°`,Q,tt)}e.textAlign="start",e.textBaseline="alphabetic"},Y=()=>{const n=st(a);e.clearRect(0,0,u,p);const D=getComputedStyle(document.body),E=D.getPropertyValue("--text-color").trim()||"#fff",o=D.getPropertyValue("--border-color").trim()||"rgba(255, 255, 255, 0.4)";U(n,E,o),$.forEach(c=>{const d=n.applyX(C(c.x)),s=n.applyY(F(c.y));d>=-2&&d<=u+2&&s>=-2&&s<=p+2&&(e.fillStyle=c.color,e.beginPath(),e.arc(d,s,2,0,2*Math.PI),e.fill())})},B=et().scaleExtent([.1,50]).on("zoom",Y);O.current=B,q(a).call(B),Y()},[m,x]);const Z=()=>{const a=j.current;a&&O.current&&q(a).transition().duration(500).call(O.current.transform,at)};return r.jsxs("section",{className:l.mathSection,children:[r.jsx("h3",{children:"r∠c = f(θ∠φ)"}),r.jsx("p",{children:"0° ≤ c(color hue) < 360°"}),r.jsxs("div",{className:l.sliderContainer,children:[r.jsxs("label",{children:[r.jsxs("span",{className:l.sliderLabelText,children:["φ (deg): ",N.toFixed(1)]}),r.jsx("input",{type:"range",min:"0",max:"359.9",step:"0.1",value:N,onChange:a=>T(parseFloat(a.target.value))})]}),r.jsxs("div",{className:l.controlPanel,children:[r.jsxs("label",{className:l.controlLabel,children:[r.jsxs("label",{className:l.toggleSwitch,children:[r.jsx("input",{type:"checkbox",checked:i,onChange:a=>A(a.target.checked)}),r.jsx("span",{className:l.slider})]}),"畫面自適應"]}),!i&&r.jsxs("label",{className:l.controlLabel,children:[r.jsx("span",{children:"半徑範圍:"}),r.jsx("input",{className:`${l.input} ${l.fixedScaleInput}`,type:"number",value:P,onChange:a=>{const e=parseFloat(a.target.value);!isNaN(e)&&e>0&&S(e)},min:"0.1",step:"any"})]}),r.jsx("button",{onClick:Z,className:`${l.buttonSecondary} ${l.alignRight}`,children:"重設視角"})]})]}),r.jsx("div",{ref:v,className:l.canvasContainer,children:r.jsx("canvas",{ref:j,className:`${l.canvas} ${l.polar}`})})]})};function ht(N,T,i){const A=Math.floor(N*6),P=N*6-A,S=i*(1-T),j=i*(1-P*T),v=i*(1-(1-P)*T);let x=0,M=0,m=0;switch((A%6+6)%6){case 0:[x,M,m]=[i,v,S];break;case 1:[x,M,m]=[j,i,S];break;case 2:[x,M,m]=[S,i,v];break;case 3:[x,M,m]=[S,j,i];break;case 4:[x,M,m]=[v,S,i];break;case 5:[x,M,m]=[i,S,j];break}return`rgb(${Math.round(x*255)}, ${Math.round(M*255)}, ${Math.round(m*255)})`}export{gt as default};
